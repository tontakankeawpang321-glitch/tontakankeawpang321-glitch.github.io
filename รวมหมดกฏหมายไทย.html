<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Lite + Chips + Slider)</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    /* ‚öñÔ∏è ‡πÇ‡∏ó‡∏ô‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ ‡∏™‡∏∏‡∏†‡∏≤‡∏û‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
    --bg:#ffffff;
    --ink:#0f1a2b;
    --muted:#6b7280;
    --line:#e6e8ee;
    --brand:#173b74;      /* ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏£‡∏°‡∏ó‡πà‡∏≤ */
    --gold:#f5d66d;        /* ‡∏ó‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô */
    --ivory:#fffdf5;      /* ‡∏Ñ‡∏£‡∏µ‡∏° */
    --radius:14px;
    --shadow-sm:0 3px 0 rgba(15,26,43,.18), 0 10px 22px -18px rgba(0,0,0,.18);
    --shadow-inset: inset 0 2px 0 rgba(255,255,255,.9), inset 0 -3px 0 rgba(0,0,0,.06);
  }
  *{box-sizing:border-box}
  html,body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:"Sarabun", system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", Arial, sans-serif;
    font-size:14px
  }
  h1,h2,h3,h4{margin:0 0 8px}
  .wrap{max-width:980px;margin:0 auto;padding:12px 12px 28px}
  .section{margin-top:12px}

  /* ‡∏Å‡∏•‡πà‡∏≠‡∏á/‡∏Å‡∏≤‡∏£‡πå‡∏î */
  .panel{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:12px;box-shadow:0 10px 20px -18px rgba(0,0,0,.18)}
  .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
  .row h3{color:var(--brand)}
  .note{color:var(--muted);font-size:12px}

  /* ‡∏õ‡∏∏‡πà‡∏° 3D ‡πÇ‡∏ó‡∏ô‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ */
  .btn{
    appearance:none;border:1px solid #d7dbe6;background:linear-gradient(#ffffff,#f7f9fd);
    padding:10px 14px;border-radius:12px;cursor:pointer;color:#0f1a2b;font-weight:700;
    box-shadow:var(--shadow-sm),var(--shadow-inset);transform:translateY(0);
    transition:transform .05s, box-shadow .1s, filter .15s; text-shadow:0 1px 0 rgba(255,255,255,.9);
  }
  .btn:hover{filter:brightness(1.02)}
  .btn:active{transform:translateY(2px);box-shadow:0 1px 0 rgba(15,26,43,.18), 0 6px 14px -10px rgba(0,0,0,.15), inset 0 2px 0 rgba(0,0,0,.06)}
  .btn.primary{border-color:#e7dba9;background:linear-gradient(var(--ivory), #ffeaa8)}
  .btn.secondary{background:linear-gradient(#ffffff,#f4f6fb);border-color:#d7dbe6}

  /* ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ */
  .searchbar{display:flex;gap:8px;margin:8px 0 12px}
  .searchbar input{flex:1;height:42px;padding:0 12px;border:1px solid var(--line);border-radius:12px;background:#fff;box-shadow:inset 0 2px 6px rgba(0,0,0,.03)}

  /* ‡∏ä‡∏¥‡∏õ‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà (Fixed 6 ‡∏´‡∏°‡∏ß‡∏î) */
  .catbar{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
  .chip{
    display:flex;align-items:center;gap:8px;justify-content:center;
    padding:14px 12px;border-radius:18px;border:1px solid var(--line);
    background:linear-gradient(#ffffff,#f6f7fb);
    box-shadow:0 8px 20px -16px rgba(0,0,0,.18);
    cursor:pointer;font-weight:800;color:var(--ink);
  }
  .chip .emoji{font-size:18px}
  .chip.active{border-color:#d9e1f2;background:linear-gradient(#f7fbff,#eef3ff);color:var(--brand)}
  .chip:focus-visible{outline:2px solid #b6c6ff;outline-offset:2px}

  /* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ */
  .list{display:grid;gap:10px;margin-top:10px}
  .card{border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;box-shadow:0 8px 18px -16px rgba(0,0,0,.15)}
  .title{margin:0 0 4px;font-weight:800;color:var(--brand)}
  .meta{display:flex;gap:6px;flex-wrap:wrap;color:var(--muted);font-size:12px}
  .tag{background:#f7f9ff;border:1px solid #e2e7f2;border-radius:999px;padding:2px 8px}
  .actions{margin-top:8px}
  .link{
    display:inline-block;font-weight:800;border:1px solid #e7dba9;border-radius:10px;padding:6px 12px;text-decoration:none;
    color:#3b2f0a;background:linear-gradient(var(--ivory), #ffeaa8);box-shadow:var(--shadow-sm),var(--shadow-inset)
  }
  .link:active{transform:translateY(2px)}

  /* ‡∏™‡πÑ‡∏•‡∏î‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î */
  .latest-slider{position:relative}
  .latest-viewport{overflow:hidden;border:1px solid var(--line);border-radius:12px;background:#fff}
  .latest-track{display:flex;transition:transform .35s ease;will-change:transform}
  .latest-slide{min-width:100%;padding:12px;display:grid;grid-template-columns:1fr;gap:6px;border-right:1px solid var(--line)}
  .latest-slide h4{margin:0 0 4px;font-size:14px;font-weight:800;color:var(--brand)}
  .latest-slide .meta{display:flex;gap:6px;flex-wrap:wrap;color:var(--muted);font-size:12px}
  .dots{display:flex;gap:6px;align-items:center;justify-content:center;margin-top:8px}
  .dot{width:6px;height:6px;border-radius:50%;background:#d9e1f2;opacity:.95}
  .dot.active{background:#1f3d75}

  .loadbar{display:flex;justify-content:center;gap:8px;margin-top:10px}
  .empty{padding:18px;text-align:center;color:var(--muted);border:1px dashed var(--line);border-radius:12px;background:#fff}

  @media (max-width:420px){ .catbar{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>
<main class="wrap">

  <section class="section">
    <div class="panel latest-slider">
      <div class="row"><h3>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3><span class="note">‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span></div>
      <div class="latest-viewport" id="latestViewport"><div id="latestTrack" class="latest-track" aria-live="polite"></div></div>
      <div id="dots" class="dots" aria-hidden="true"></div>
    </div>
  </section>

  <section class="section">
    <div class="searchbar" role="search">
      <input id="q" type="search" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏•‡πà‡∏°‡∏ï‡∏≠‡∏ô/‡∏´‡∏°‡∏ß‡∏î)..." aria-label="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢">
      <button id="btnSearch" class="btn primary" type="button">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
    </div>
  </section>

  <section class="section">
    <div class="catbar" id="catbar" role="tablist" aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢">
      </div>

    <div class="panel" style="margin-top:8px">
      <div class="row">
        <h3 id="panelTitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
        <div id="panelNote" class="note">‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡∏∞ 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
      </div>
      <div id="list" class="list"></div>
      <div class="loadbar">
        <button id="btnPrev" class="btn secondary" type="button" style="display:none">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button id="btnNext" class="btn primary" type="button" style="display:none">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
      </div>
    </div>
  </section>
</main>

<script>
/* ===== ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà/‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ===== */
const PAGE_SIZE = 5;
/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤ */
let lawsData = [];

async function loadJsonAndStart() {
  try {
    const res = await fetch("./lawsData.json", { cache: "no-store" });
    lawsData = await res.json();

    renderChips();
    loadAllData();

    const u = new URL(location.href);
    const initQ = u.searchParams.get("q") || "";
    if (initQ) { document.querySelector("#q").value = initQ; doSearch(); }

  } catch (e) {
    console.error("‡πÇ‡∏´‡∏•‡∏î lawsData.json ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", e);
    document.getElementById("list").innerHTML =
      `<div class="empty">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</div>`;
  }
}

/* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏ô JSON */
const COLS = { category:"‡∏´‡∏°‡∏ß‡∏î", title:"‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢", date:"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", volume:"‡πÄ‡∏•‡πà‡∏°+‡∏ï‡∏≠‡∏ô", url:"URL_PDF" };
const col = k => COLS[k];

/* ‡∏´‡∏°‡∏ß‡∏î‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î) + ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô */
const FIXED_CATS = [
  {key:"‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢",      label:"‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢",      emoji:"üìö"},
  {key:"‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç",          label:"‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç",          emoji:"üìú"},
  {key:"‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏§‡∏©‡∏é‡∏µ‡∏Å‡∏≤",     label:"‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏§‡∏©‡∏é‡∏µ‡∏Å‡∏≤",     emoji:"üèõÔ∏è"},
  {key:"‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏≥‡∏´‡∏ô‡∏î",       label:"‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏≥‡∏´‡∏ô‡∏î",       emoji:"üìò"},
  {key:"‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥",     label:"‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥",     emoji:"üìñ"},
  {key:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£",          label:"‡∏Å‡∏é‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á",          emoji:"üß∑"}
];

/* ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏∞‡∏Å‡∏î‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ ‚Üí ‡πÅ‡∏°‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô */
function normalizeCatName(raw=""){
  const s = (raw||"").trim();
  const map = new Map([
    ["‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢","‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢"], ["‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏Å‡∏è‡∏´‡∏°‡∏≤‡∏¢","‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢"],
    ["‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç","‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç"],
    ["‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏§‡∏©‡∏é‡∏µ‡∏Å‡∏≤","‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏§‡∏©‡∏é‡∏µ‡∏Å‡∏≤"], ["‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏Å‡∏é‡∏µ‡∏Å‡∏≤","‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏§‡∏©‡∏é‡∏µ‡∏Å‡∏≤"], ["‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏é‡∏µ‡∏Å‡∏≤","‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏§‡∏©‡∏é‡∏µ‡∏Å‡∏≤"],
    ["‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏≥‡∏´‡∏ô‡∏î","‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏Å‡∏≥‡∏´‡∏ô‡∏î"],
    ["‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥","‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥"],
    ["‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£","‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£"], ["‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£","‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£"]
  ]);
  return map.get(s) || s;
}

const $ = (s,el=document)=>el.querySelector(s);

/* ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ URL */
function sanitizeUrl(u=''){
  try{ const url=new URL(u, location.origin); if(url.protocol==='http:'||url.protocol==='https:') return url.href; }catch{}
  return '';
}

/* ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ó‡∏¢/‡∏û.‡∏®. */
const TH_MONTHS={'‡∏°.‡∏Ñ.':1,'‡∏Å.‡∏û.':2,'‡∏°‡∏µ.‡∏Ñ.':3,'‡πÄ‡∏°.‡∏¢.':4,'‡∏û.‡∏Ñ.':5,'‡∏°‡∏¥.‡∏¢.':6,'‡∏Å.‡∏Ñ.':7,'‡∏™.‡∏Ñ.':8,'‡∏Å.‡∏¢.':9,'‡∏ï.‡∏Ñ.':10,'‡∏û.‡∏¢.':11,'‡∏ò.‡∏Ñ.':12,'‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°':1,'‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå':2,'‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°':3,'‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô':4,'‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°':5,'‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô':6,'‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°':7,'‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°':8,'‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô':9,'‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°':10,'‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô':11,'‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°':12};
function thDigitsToArabic(s=''){const m={'‡πê':'0','‡πë':'1','‡πí':'2','‡πì':'3','‡πî':'4','‡πï':'5','‡πñ':'6','‡πó':'7','‡πò':'8','‡πô':'9'}; return s.replace(/[‡πê-‡πô]/g,ch=>m[ch]??ch);}
function parseDateTS(s){
  if(!s) return 0; s=s.trim();
  const onlyBuddhist = s.match(/^‡∏û\.‡∏®\.?\s*([0-9‡πê-‡πô]{4})$/);
  if(onlyBuddhist){ let y=parseInt(thDigitsToArabic(onlyBuddhist[1]),10)-543; return new Date(y,0,1).getTime(); }
  const th = s.match(/^([0-9‡πê-‡πô]{1,2})\s+([‡∏Å-‡πô\.]+)\s+([0-‡πô0-9]{4})$/);
  if(th){
    const d=parseInt(thDigitsToArabic(th[1]),10);
    const m=TH_MONTHS[th[2]]||0;
    let y=parseInt(thDigitsToArabic(th[3]),10);
    if(y>2400) y-=543;
    return (m&&d&&y)? new Date(y,m-1,d).getTime():0;
  }
  if(/^\d{4}-\d{2}-\d{2}$/.test(s)){ let [y,m,d]=s.split('-').map(n=>+n); if(y>2400) y-=543; return new Date(y,(m||1)-1,(d||1)).getTime(); }
  if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(s)){ let [d,m,y]=s.split('/').map(n=>+n); if(y>2400) y-=543; return new Date(y,(m||1)-1,(d||1)).getTime(); }
  return 0;
}
function fmtDateThai(s){
  if(!s) return '';
  if(/^[0-9]{4}-/.test(s)||/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(s)){
    let y,m,d;
    if(s.includes('-')){[y,m,d]=s.split('-').map(n=>+n);} else{[d,m,y]=s.split('/').map(n=>+n);}
    if(y<2400) y+=543;
    const mm=['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'];
    return `${d} ${mm[(m||1)-1]} ${y}`;
  }
  return s;
}

/* ===== ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ===== */
const catbar = $("#catbar");
const listEl = $("#list");
const btnNext = $("#btnNext");
const btnPrev = $("#btnPrev");
const panelTitle = $("#panelTitle");
const panelNote = $("#panelNote");

const CatState = {};  // { [cat]: { rows:[], page:0, loaded:true } }
let selectedCat = null;
const allIndex = [];
let LatestData = [];

function escapeHtml(s){return (''+s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function renderCard(r){
  const t=r[col('title')]||'', d=r[col('date')]||'', v=r[col('volume')]||'', c=r[col('category')]||'', u=r[col('url')]||'';
  const safe = sanitizeUrl(u);
  return `<article class="card">
    <h4 class="title">${escapeHtml(t)||'(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)'}</h4>
    <div class="meta">
      ${c?`<span class="tag">‡∏´‡∏°‡∏ß‡∏î: ${escapeHtml(c)}</span>`:''}
      ${d?`<span class="tag">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${escapeHtml(fmtDateThai(d))}</span>`:''}
      ${v?`<span class="tag">‡πÄ‡∏•‡πà‡∏°+‡∏ï‡∏≠‡∏ô: ${escapeHtml(v)}</span>`:''}
    </div>
    <div class="actions">
      ${safe?`<a class="link" href="${safe}" target="_blank" rel="noopener noreferrer">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏≠‡πà‡∏≤‡∏ô</a>`:`<span class="note">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå</span>`}
    </div>
  </article>`;
}

/* ===== ‡πÄ‡∏ï‡∏¥‡∏°‡∏ä‡∏¥‡∏õ‡∏´‡∏°‡∏ß‡∏î‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà ===== */
function renderChips(){
  catbar.innerHTML = FIXED_CATS.map(c => `
    <button class="chip" type="button" role="tab" aria-selected="false" data-cat="${c.key}">
      <span class="emoji">${c.emoji}</span><span>${c.label}</span>
    </button>
  `).join('');
}

/* ===== ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ===== */
function loadAllData(){
  listEl.innerHTML=`<div class="empty">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>`;
  try {
    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°
    FIXED_CATS.forEach(({key}) => {
        CatState[key] = {rows: [], page: 0, loaded: true};
    });

    // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
    lawsData.forEach(item => {
        const normCat = normalizeCatName(item[col('category')]);
        if (CatState[normCat]) {
            const processedItem = {...item, _ts: parseDateTS(item[col('date')])};
            CatState[normCat].rows.push(processedItem);
            allIndex.push(processedItem);
        }
    });

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    FIXED_CATS.forEach(({key}) => {
        if (CatState[key].rows.length > 0) {
            CatState[key].rows.sort((a, b) => (b._ts || 0) - (a._ts || 0));
            LatestData.push({cat: key, row: CatState[key].rows[0]});
        }
    });


    // ‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå‡∏ä‡∏¥‡∏õ
    catbar.addEventListener('click', e=>{
      const b=e.target.closest('button[data-cat]'); if(!b) return;
      selectCategory(b.dataset.cat); b.focus();
    });
    catbar.addEventListener('keydown', e=>{
      const chips=[...catbar.querySelectorAll('.chip')];
      if(!chips.length) return;
      const i=chips.findIndex(t=>t.dataset.cat===selectedCat);
      if(e.key==='ArrowRight'||e.key==='ArrowDown'){
        const n=chips[(i+1+chips.length)%chips.length]; selectCategory(n.dataset.cat); n.focus(); e.preventDefault();
      }else if(e.key==='ArrowLeft'||e.key==='ArrowUp'){
        const p=chips[(i-1+chips.length)%chips.length]; selectCategory(p.dataset.cat); p.focus(); e.preventDefault();
      }
    });

    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡πÅ‡∏£‡∏Å
    selectCategory(FIXED_CATS[0].key);

    // ‡∏™‡πÑ‡∏•‡∏î‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    buildLatestSlider();

  } catch(e) {
    listEl.innerHTML=`<div class="empty">‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>`;
    console.error(e);
  }
}

/* ===== ‡πÄ‡∏û‡∏à/‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ===== */
function renderPage(cat){
  const st=CatState[cat]; if(!st) return;
  const start=st.page*PAGE_SIZE, end=start+PAGE_SIZE;
  const slice=st.rows.slice(start,end);
  listEl.innerHTML = slice.length? slice.map(renderCard).join('') : `<div class="empty">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>`;

  btnPrev.style.display = (st.page>0)? 'inline-block':'none';
  btnNext.style.display = (end < st.rows.length)? 'inline-block':'none';

  panelTitle.textContent = `${cat} ‚Äî ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î`;
  panelNote.textContent  = `‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡∏∞ ${PAGE_SIZE} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏£‡∏ß‡∏° ${st.rows.length})`;
}
function selectCategory(cat){
  if(selectedCat===cat) return;
  selectedCat=cat;
  [...catbar.querySelectorAll('.chip')].forEach(b=>{
    const on = b.dataset.cat===cat;
    b.classList.toggle('active', on);
    b.setAttribute('aria-selected', on?'true':'false');
    b.setAttribute('tabindex', on?'0':'-1');
  });
  if(CatState[cat]){
    CatState[cat].page=0;
    renderPage(cat);
  } else {
    listEl.innerHTML = `<div class="empty">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà "${cat}"</div>`;
  }
}
btnNext.addEventListener('click', ()=>{
  if(!selectedCat) return;
  const st=CatState[selectedCat]; if(!st) return;
  st.page+=1; renderPage(selectedCat);
});
btnPrev.addEventListener('click', ()=>{
  if(!selectedCat) return;
  const st=CatState[selectedCat]; if(!st) return;
  if(st.page>0){ st.page-=1; renderPage(selectedCat); }
});

/* ===== ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ===== */
const elQ = $("#q"), elBtnSearch=$("#btnSearch");
elBtnSearch.addEventListener('click', doSearch);
elQ.addEventListener('keydown', e=>{ if(e.key==='Enter') doSearch(); });
function normalizeThai(s){ return (s||'').toLowerCase().replace(/\s+/g,' ').trim().normalize('NFC').replace(/[\u0E31\u0E34-\u0E3A\u0E47-\u0E4E]/g,''); }
function doSearch(){
  const q=(elQ.value||'').trim();
  if(!q){ if(selectedCat) renderPage(selectedCat); return; }
  const nq=normalizeThai(q);
  const results = allIndex.filter(o=>{
    const t=normalizeThai(o[col('title')]||''),
          v=normalizeThai(o[col('volume')]||''),
          c=normalizeThai(o[col('category')]||'');
    return t.includes(nq)||v.includes(nq)||c.includes(nq);
  }).sort((a,b)=>(b._ts||0)-(a._ts||0));
  listEl.innerHTML = results.slice(0,50).map(renderCard).join('') || `<div class="empty">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</div>`;
  btnNext.style.display='none';
  btnPrev.style.display='none';
  panelTitle.textContent = `‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‚Äú${q}‚Äù`;
  panelNote.textContent  = `‡∏û‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${results.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 50 ‡πÅ‡∏£‡∏Å)`;
}

/* ===== ‡∏™‡πÑ‡∏•‡∏î‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ===== */
const latestViewport = $("#latestViewport");
const latestTrack = $("#latestTrack");
const dotsEl = $("#dots");
let latestSlides=[]; let latestIndex=0; let autoTimer=null;

function updateLatestSlider(){
  const w = latestViewport.getBoundingClientRect().width;
  latestTrack.style.transform = `translateX(${-latestIndex*w}px)`;
  [...dotsEl.children].forEach((d,i)=>d.classList.toggle('active', i===latestIndex));
}
function nextLatest(){ if(!latestSlides.length) return; latestIndex = (latestIndex + 1) % latestSlides.length; updateLatestSlider(); }
function startAuto(){ stopAuto(); autoTimer = setInterval(nextLatest, 4000); }
function stopAuto(){ if(autoTimer){ clearInterval(autoTimer); autoTimer=null; } }
document.addEventListener('visibilitychange', ()=>{ document.hidden ? stopAuto() : startAuto(); });
latestViewport.addEventListener('mouseenter', stopAuto);
latestViewport.addEventListener('mouseleave', startAuto);
window.addEventListener('resize', updateLatestSlider);

function buildLatestSlider(){
  latestTrack.innerHTML=''; dotsEl.innerHTML='';
  latestSlides = LatestData.filter(Boolean).sort((a,b)=>(b.row._ts||0) - (a.row._ts||0));

  if(!latestSlides.length){
    latestTrack.innerHTML = `<div class="latest-slide"><div class="meta">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div></div>`;
    return;
  }
  latestTrack.innerHTML = latestSlides.map(({cat,row})=>{
    const t=row[col('title')]||'', d=row[col('date')]||'', u=row[col('url')]||'#';
    const safe = sanitizeUrl(u);
    return `<div class="latest-slide">
      <h4>${escapeHtml(t)||'(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)'}</h4>
      <div class="meta"><span class="tag">‡∏´‡∏°‡∏ß‡∏î: ${escapeHtml(cat)}</span><span class="tag">${escapeHtml(fmtDateThai(d))}</span></div>
      ${safe?`<div class="actions" style="margin-top:6px"><a class="link" href="${safe}" target="_blank" rel="noopener noreferrer">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏≠‡πà‡∏≤‡∏ô</a></div>`:''}
    </div>`;
  }).join('');
  dotsEl.innerHTML = latestSlides.map((_,i)=>`<span class="dot ${i===0?'active':''}"></span>`).join('');
  latestIndex=0; updateLatestSlider(); startAuto();
}

loadJsonAndStart();

</script>
</body>
</html>

